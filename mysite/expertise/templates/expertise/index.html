{% extends "expertise/base.html" %}

{% block head_js %}
{% load static %}
<script type="module" src="{% static 'expertise/index.js' %}"></script>
{% endblock %}

{% block title %}Expertise overview{% endblock %}

{% block content %}
{% load expertise_extras %}
<div class="table-no-scroll">
    <div class="d-flex justify-content-center">
        <form class="home">
            <div class="mb-3">
                <!-- maybe give instructions for difference between filter and search -->
                <h3 class="mb-3">
                    Expertise graph
                    <button class="clipboard-button filters" type="button" title="Copy chosen filters" data-in-start-state="true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-clipboard2 align-baseline" viewBox="0 0 16 16">
                            <path
                                d="M3.5 2a.5.5 0 0 0-.5.5v12a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-12a.5.5 0 0 0-.5-.5H12a.5.5 0 0 1 0-1h.5A1.5 1.5 0 0 1 14 2.5v12a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-12A1.5 1.5 0 0 1 3.5 1H4a.5.5 0 0 1 0 1h-.5Z" />
                            <path
                                d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-clipboard2-check d-none align-baseline" viewBox="0 0 16 16">
                            <path
                                d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z" />
                            <path
                                d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z" />
                            <path
                                d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z" />
                        </svg>
                    </button>
                </h3>
                <label for="search-filter" class="form-label visually-hidden">Search and filter</label>
                <select class="form-select search-filter" multiple="multiple" name="filters[]" autofocus autocomplete="off">
                    <optgroup class="search" label="Search history"></optgroup>
                    {% for key, item in suggestions.items %}
                    <optgroup class="{{ item.class }}" label="{{ item.group }}">
                        {% comment %}
                            the pk is prefixed so select2 can distinguish between
                            e.g. offered and wanted expertise which can be the same node
                            in the database
                        {% endcomment %}
                        {% for suggestion in item.options %}
                        {% formatted_node_pk key suggestion.pk as id %}
                        <option class="{{ item.class }}" value="{{ id }}" {% if id in selected_options %}selected {% endif %} data-alternatives="{% jsonify suggestion.alternatives %}">{{ suggestion.name }}</option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3 d-flex">
                <div class="col">
                    <button type="submit" id="search-button" class="btn btn-primary">Search</button>
                </div>
                <div>
                    <div class="alert search-alert py-2 d-none" role="alert">
                        alert text placeholder that you shouldn't see :&#41
                    </div>
                </div>
            </div>
        </form>
    </div>

    {% comment %}
    the scrollable table container is focusable in firefox if the container elements
    are not focusable (feature). set tabindex -1 to prevent this but enables mouse-focusable.
    if tabs/arrows can be used to "scroll", i.e. focus, through the tablerows,
    is that behavior needed?
    https://bugzilla.mozilla.org/show_bug.cgi?id=1069739#c24
    {% endcomment %}
    <div class="table-responsive d-none persons-table-container" tabindex="-1">
        <table class="persons-table table table-hover table-sm">
            {# table-primary for head color because borders don't work with sticky #}
            <thead>
                <tr>
                    <th scope="col"><span class="visually-hidden">Email</span></th>
                    <th scope="col" class="person">Name</th>
                    <th scope="col" class="interest">Research interest</th>
                    <th scope="col" class="institute">Institute</th>
                    <th scope="col" class="faculty">Faculty</th>
                    <th scope="col" class="department">Department</th>
                    <th scope="col" class="person">Advisor</th>
                    <th scope="col" class="role">Role in ScaDS.AI</th>
                    <th scope="col" class="expertise">Offered expertise</th>
                    <th scope="col" class="expertise">Wanted expertise</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <div id="share-data" class="d-none" data-table="{{ table_data }}" data-search="{{ search }}" data-graph="{{ graph_node }}"></div>
    </div>

    <div class="modal fade" id="graphModal" tabindex="-1" aria-labelledby="graphModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="graphModalLabel">
                        Network graph
                        <button class="clipboard-button filters-graph" type="button" title="Copy chosen filters and graph view" data-in-start-state="true">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-clipboard2 align-baseline" viewBox="0 0 16 16">
                                <path
                                    d="M3.5 2a.5.5 0 0 0-.5.5v12a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-12a.5.5 0 0 0-.5-.5H12a.5.5 0 0 1 0-1h.5A1.5 1.5 0 0 1 14 2.5v12a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-12A1.5 1.5 0 0 1 3.5 1H4a.5.5 0 0 1 0 1h-.5Z" />
                                <path
                                    d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-clipboard2-check d-none align-baseline" viewBox="0 0 16 16">
                                <path
                                    d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z" />
                                <path
                                    d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z" />
                                <path
                                    d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z" />
                            </svg>
                        </button>
                    </h1>
                    <div>
                        <button type="button" class="btn-close graph-minimize" data-bs-dismiss="modal" aria-label="Minimize"></button>
                        <button type="button" class="btn-close graph-close ms-2" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body d-flex flex-wrap justify-content-center">
                    <div class="spinner-border text-primary graph-spinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div id="graph-container">
                        <div class="alert alert-warning graph-alert py-2 d-inline-block d-none" role="alert">
                            alert text placeholder that you shouldn't see :&#41
                        </div>
                        <span class="position-absolute graph-helptext">
                            Shift + Click a node to toggle filters
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn btn-primary graph-maximize d-none" data-bs-toggle="modal" data-bs-target="#graphModal" aria-label="Maximize graph">
        Maximize
        <i class="bi bi-diagram-3" aria-hidden="true"></i>
    </button>
</div>

{% endblock %}